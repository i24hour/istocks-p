generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Stock {
  id        String         @id @default(cuid())
  symbol    String         @unique
  name      String
  exchange  String         @default("NSE")
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  insights  StockInsight[]
  priceData StockPrice[]

  @@index([symbol])
}

model StockPrice {
  id            String   @id @default(cuid())
  stockId       String
  timestamp     DateTime
  open          Float
  high          Float
  low           Float
  close         Float
  volume        BigInt
  sma20         Float?
  sma50         Float?
  sma200        Float?
  ema12         Float?
  ema26         Float?
  macd          Float?
  macdSignal    Float?
  macdHistogram Float?
  adx           Float?
  plusDI        Float?
  minusDI       Float?
  rsi           Float?
  stochK        Float?
  stochD        Float?
  cci           Float?
  williamsR     Float?
  roc           Float?
  bbUpper       Float?
  bbMiddle      Float?
  bbLower       Float?
  atr           Float?
  obv           BigInt?
  vwap          Float?
  forceIndex    Float?
  adLine        Float?
  createdAt     DateTime @default(now())
  stock         Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)

  @@unique([stockId, timestamp])
  @@index([stockId, timestamp(sort: Desc)])
  @@index([timestamp])
}

model StockInsight {
  id              String   @id @default(cuid())
  stockId         String
  timeframe       String
  trend           String
  trendStrength   Float
  momentum        String
  volatility      String
  volumeAnalysis  String
  supportLevel    Float?
  resistanceLevel Float?
  summary         String
  generatedAt     DateTime @default(now())
  stock           Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)

  @@unique([stockId, timeframe])
  @@index([stockId])
}
